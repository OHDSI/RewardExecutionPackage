<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Executing Reward • RewardExecutionPackage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Executing Reward">
<meta property="og:description" content="RewardExecutionPackage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RewardExecutionPackage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ExecutingReward.html">Executing Reward</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Executing Reward</h1>
            
            <h4 data-toc-skip class="date">2022-01-11</h4>
      
      
      <div class="hidden name"><code>ExecutingReward.rmd</code></div>

    </div>

    
    
<style type="text/css">
h1  {
  margin-top: 60px;
}
</style>
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p>REWARD is designed to be a rapid platform for producing population level effect estimates from observational healthcare data. This package forms the execution proportion of REWARD - the minimum amount of code required to generate results.</p>
<p>Note: further analysis (unblinding) of results requires a more principled approach than is provided in this vignette</p>
</div>
<div class="section level1">
<h1 id="installation-and-configuration-of-execution-environment">Installation and configuration of execution environment<a class="anchor" aria-label="anchor" href="#installation-and-configuration-of-execution-environment"></a>
</h1>
<p>We recommend creating a new RStudio project and using <code>renv</code> to manage packages related to REWARD.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In a new rstudio environment</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"renv"</span><span class="op">)</span>
<span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/init.html" class="external-link">init</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The next step is to install the latest version of the <code>RewardExecutionPackage</code>. This can be achieved as follows (requires <code>remotes</code> R package).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In a new rstudio environment</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ohdsi/RewardExecutionPackage"</span><span class="op">)</span></code></pre></div>
<p>Providing your environment is configured correctly, the package should be installed correctly.</p>
</div>
<div class="section level1">
<h1 id="creating-a-cdm-configuration-yaml-file">Creating a CDM configuration YAML file<a class="anchor" aria-label="anchor" href="#creating-a-cdm-configuration-yaml-file"></a>
</h1>
<p>To execute the REWARD components we must first create a configuration file that determines the usage of a CDM. This details the relevant tables, database schemas and other parameters required to execute a study. The simplest way to do this is to use the utility function provided in the package as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/createCdmConfiguration.html">createCdmConfiguration</a></span><span class="op">(</span><span class="st">"myCdmConfig.yml"</span>, useKeyring <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This will create the file <code>myCdmConfig.yml</code> and load up an editor that will require you to alter the configuration specific to your cdm.</p>
<div class="section level2">
<h2 id="data-source-information">Data source information<a class="anchor" aria-label="anchor" href="#data-source-information"></a>
</h2>
<p>This should be information that is unique to your CDM. The <code>sourceId</code> won’t be relevant unless it is registed in the central reward database. However, the database and name should be the cdm on your system.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sourceId</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">database</span><span class="kw">:</span><span class="at"> MyCdmDatabaseName</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> MyCdmFriendlyName</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="file-storage">File storage<a class="anchor" aria-label="anchor" href="#file-storage"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exportPath</span><span class="kw">:</span><span class="at"> </span><span class="st">"export"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">referencePath</span><span class="kw">:</span><span class="at"> </span><span class="st">"reference_files"</span></span></code></pre></div>
<p>The file storage locations are crucial, the path to <code>export</code> should be a location on disk that is at least 25GB in size as results from the REWARD analysis can be large.</p>
<p>The reference files path is just a location where the cohort definitions for reward can be stored. These should be provided from the central reward database.</p>
</div>
<div class="section level2">
<h2 id="setting-connection-details">Setting Connection Details<a class="anchor" aria-label="anchor" href="#setting-connection-details"></a>
</h2>
<p>Crucially, reward needs to be able to connect to your CDM. These settings should conform to a <code>DatabaseConnector connectionDetails</code> object. However, reward does not require a password to be stored in plaintext in this configuration (though, this can optionally be done if you have lower security requirements).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">connectionDetails</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dbms</span><span class="kw">:</span><span class="at"> </span><span class="st">"postgresql"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">server</span><span class="kw">:</span><span class="at"> </span><span class="st">"localhost/reward"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # If username is unset it will be the system username</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # Alternatively, set environment variable REWARD_CDM_USER</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user</span><span class="kw">:</span><span class="at"> </span><span class="st">"postgres"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use keyring package for storing database credentials</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">useSecurePassword</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">keyringService</span><span class="kw">:</span><span class="at"> </span><span class="st">"reward_cdm"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use DatabaseConnector bulk upload, where possible</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># See DatabaseConnector documentation for more information</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bulkUpload</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span></code></pre></div>
<p>Because the <code>useSecurePassword</code> parameter is set to true, the database password you use for your cdm will be stored securely for reuse using the r <code>keyring</code> package. You should be prompted for this password when you press save. For more details on how this works, consult the keyring documentation <a href="https://r-lib.github.io/keyring/index.html" class="external-link">here</a>. If you intend to execute this packge on multiple cdms that have the same user credentials, this information does not need to be re-entered when you</p>
</div>
<div class="section level2">
<h2 id="schemas-and-tables">Schemas and tables<a class="anchor" aria-label="anchor" href="#schemas-and-tables"></a>
</h2>
<p>The following settings are likely specific to your CDM and need to be configured. We strongly suggest you have an isolated <code>reward</code> database schema for reward that can be written to, separate from your CDM. This single schema can contain cohort results as well as references. The location of your cdm and vocabulary may be the same.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Where cohort results are stored</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">resultSchema</span><span class="kw">:</span><span class="at"> </span><span class="st">"reward"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Where reference files are imported</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">referenceSchema</span><span class="kw">:</span><span class="at"> </span><span class="st">"reward"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># OMOP Common Data Model Schema</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cdmSchema</span><span class="kw">:</span><span class="at"> </span><span class="st">"cdmv5"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># schema that contains OMOP vocabulary tables</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vocabularySchema</span><span class="kw">:</span><span class="at"> </span><span class="st">"cdmv5"</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: schema for storing custom drug eras</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">drugEraSchema</span><span class="kw">:</span><span class="at"> </span><span class="st">"reward"</span></span></code></pre></div>
<p>These are the tables used by reward. These only need to be changed if they conflict with other tables in your schema (e.g. if you are executing reward on multiple CDMS on the same database).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tables to be created and used by REWARD</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tables</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">outcomeCohort</span><span class="kw">:</span><span class="at"> </span><span class="st">"outcome_cohort"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cohort</span><span class="kw">:</span><span class="at"> </span><span class="st">"exposure_cohort"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">sccResult</span><span class="kw">:</span><span class="at"> </span><span class="st">"scc_result"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # Reference table definitions</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cohortDefinition</span><span class="kw">:</span><span class="at"> </span><span class="st">"cohort_definition"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">outcomeCohortDefinition</span><span class="kw">:</span><span class="at"> </span><span class="st">"outcome_cohort_definition"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">conceptSetDefinition</span><span class="kw">:</span><span class="at"> </span><span class="st">"concept_set_definition"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">atlasOutcomeReference</span><span class="kw">:</span><span class="at"> </span><span class="st">"atlas_outcome_reference"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">atlasOutcomeConcept</span><span class="kw">:</span><span class="at"> </span><span class="st">"atlas_outcome_concept"</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">atlasExposureReference</span><span class="kw">:</span><span class="at"> </span><span class="st">"atlas_exposure_reference"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">atlasExposureConcept</span><span class="kw">:</span><span class="at"> </span><span class="st">"atlas_exposure_concept"</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">customExposure</span><span class="kw">:</span><span class="at"> </span><span class="st">"custom_exposure"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">customExposureConcept</span><span class="kw">:</span><span class="at"> </span><span class="st">"custom_exposure_concept"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">analysisSetting</span><span class="kw">:</span><span class="at"> </span><span class="st">"analysis_setting"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="testing-the-configuration">Testing the configuration<a class="anchor" aria-label="anchor" href="#testing-the-configuration"></a>
</h2>
<p>By default, the information you use will be tested. This includes connecting to the database and ensuring that all the relevant schemas exist and the user has read/write permissions to the relevant database schemas. If, at any point, you manually edit the yaml configuration remember to call <code>validateCdmConfigFile</code> to test if the parameters are valid.</p>
</div>
</div>
<div class="section level1">
<h1 id="executing-the-reward-study">Executing the REWARD study<a class="anchor" aria-label="anchor" href="#executing-the-reward-study"></a>
</h1>
<p>The simplest way to execute REWARD is to use an Rstudio session with the following code.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#TODO</span></code></pre></div>
<p>Alternatively, you can use the execute function from inside an r session</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/execute.html">execute</a></span><span class="op">(</span><span class="va">cdmConfigPath</span>, <span class="va">referenceZipFile</span>, deleteExistingCohorts <span class="op">=</span> <span class="va">deleteExistingCohorts</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="uploading-results">Uploading results<a class="anchor" aria-label="anchor" href="#uploading-results"></a>
</h1>
<p>First your CDM must be registered within the REWARD database.</p>
<p>The results CSV files can then be shared with the OhdsiSharing package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TODO</span></code></pre></div>
<p>Once compiled, the post processing, analysis and viewing of results can be completed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jamie Gilbert.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
